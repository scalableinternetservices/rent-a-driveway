
<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-timepicker/1.8.3/jquery.timepicker.min.css">
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-timepicker/1.8.3/jquery.timepicker.min.js"></script>
<%#This script is for google map api and figure out the current long lat%>
<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<!-- This form is not supposed to post anything
    Instead, we use jquery to intercept, perform geocode search
    Then update the map below to show available listings
    For more info look for js/search_location.js
-->
<div class="row">
	<div class="col-md-7">
		<div id="map" style="height: 500px;"></div>
	</div>
	<div class="col-md-5">
		<div class="row">
			<form method="get" id="search_location_form" action="/" >
				<div id="search_options">
					<h2 class="green">Search</h2>
					<div class="row">
						<div class="col-md-3">
							<label for="location">Location:</label>
						</div>
						<div class="col-md-7">
							<input class="form-control" type="text" id="location_input" name="location"/>
			                <input type="hidden" id="latitude" name="latitude"/>
							<input type="hidden" id="longitude" name="longitude"/>
						</div>
					</div>
					<div class="row">
						<div class="col-md-3">
							<label for="start_time">Start Time:</label>
						</div>
						<div class="col-md-3">
							<input class="form-control" type="text" id="start_date" name="start_date"/>
						</div>
						<div class="col-md-offset-1 col-md-3">
							<input class="form-control" type="text" id="start_time" name="start_time"/>
						</div>
					</div>
					<div class="row">
						<div class="col-md-3">
							<label for="end_time">End Time:</label>
						</div>
						<div class="col-md-3">
							<input class="form-control" type="text" id="end_date" name="end_date"/>
						</div>
						<div class="col-md-offset-1 col-md-3">
							<input class="form-control" type="text" id="end_time" name="end_time"/>
						</div>
					</div>
					<div class="row">
						<div class="col-md-3">
							<label for="price_range">Price Range:</label>
						</div>
						<div class="col-md-3">
							<input class="form-control" type="text" id="min_price" name="min_price"/>
						</div>
						<div class="col-md-1"><label>to</label></div>
						<div class="col-md-3">
							<input class="form-control" type="text" id="max_price" name="max_price"/>
						</div>
					</div>
					<div class="row">
						<div class="col-md-offset-5 col-md-2">
							<input type="submit" value="Search">
						</div>
				</div>
			  </div>
			</form>
		</div>
		<div id="search" class="row">
			<div id="listing" class="row">
				<div class="col-md-12">
					<table class="sort_table">
					  <tr>
						<th><%=sortable "address"%></th>
							<th><%=sortable "start_time", "Start Time"%></th>
							<th><%=sortable "end_time", "End Time"%></th>
							<th><%=sortable "price"%></th>
							<% if is_buyer(current_user) %>
							<th><%=sortable "status"%></th>
							<% end %>
					  </tr>
					 
					  <% @nearby_listings.each do |listing| %>
						  <tr>
							<td><%= listing.address %></td>
								<td><%= listing.start_time.strftime("%B %e %Y %l:00") %></td>
								<td><%= listing.end_time.strftime("%B %e %Y %l:00") %></td>
								<td><%= sprintf("$%.2f", listing.price) %></td>
								<% if is_buyer(current_user) %>
								<td style="text-align: center;"><%= listing.status %></td>
								<% end %>
								<td><%= link_to 'Details', listing_path(listing) %></td>
						  </tr>
                      <% end %>
					</table>
				</div>
			</div>
	    </div>
    </div>
</div>

<script>
		handler = Gmaps.build('Google');
		handler.buildMap({ provider: { Zoom: 15 }, internal: {id: 'map'}}, function(){
		  markers = handler.addMarkers(<%= raw @markers.to_json %>);
		  handler.bounds.extendWith(markers);
		  handler.map.centerOn({"lat": <%= @cur_lat %>, "lng": <%= @cur_lng %>});
		});
	$("#start_date").datepicker({"dateFormat": "yy-mm-dd"});
	$("#start_time").timepicker();
	$("#end_date").datepicker({"dateFormat": "yy-mm-dd"});
	$("#end_time").timepicker();

	// check user fills out search criteria before submitting form
	$("#search_location_form").submit(function(){
		if ($("#start_date").val().length == 0 || $("#end_date").val().length == 0 || $("#start_time").val().length == 0 || $("#end_time").val().length == 0 || $("#location").val().length == 0){
			alert("You haven't filled out the search criteria");
			return false;
		} else
			return true;
	});
</script>
